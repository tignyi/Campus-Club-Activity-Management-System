<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>活動瀏覽 - 校園社團活動管理系統</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 100%);
      min-height: 100vh;
    }
    .navbar {
      background: #4f8cff;
    }
    .navbar-brand, .nav-link, .navbar-text {
      color: #fff !important;
    }
    .event-card {
      border-radius: 1rem;
      box-shadow: 0 2px 12px rgba(79,140,255,0.08);
      transition: transform 0.15s;
    }
    .event-card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 4px 24px rgba(79,140,255,0.15);
    }
    .event-img {
      border-radius: 1rem 1rem 0 0;
      object-fit: cover;
      height: 180px;
      width: 100%;
    }
    .category-badge {
      background: #e0e7ff;
      color: #4f8cff;
      font-size: 0.9em;
      border-radius: 0.5rem;
      padding: 0.2em 0.7em;
      margin-right: 0.5em;
    }
    @media (max-width: 576px) {
      .event-img { height: 120px; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html"><i class="fa-solid fa-people-group me-2"></i>社團活動管理</a>
      <span class="navbar-text ms-auto"><i class="fa-solid fa-user-circle me-1"></i>student</span>
    </div>
  </nav>
  <div class="container">
    <div class="row mb-4 align-items-center">
      <div class="col-md-4 mb-2 mb-md-0">
        <h2 class="fw-bold"><i class="fa-solid fa-calendar-days me-2 text-primary"></i>活動瀏覽</h2>
      </div>
      <div class="col-md-8 text-md-end">
        <select class="form-select d-inline-block w-auto me-2" id="categoryFilter">
          <option value="">所有分類</option>
          <option value="社團講座">社團講座</option>
          <option value="體育競賽">體育競賽</option>
          <option value="藝文展演">藝文展演</option>
        </select>
        <input type="date" class="form-control d-inline-block w-auto" id="dateFilter">
      </div>
    </div>
    <div class="row" id="eventsList">
      <!-- 活動卡片將由 JS 動態產生 -->
    </div>
    <div id="noEvents" class="text-center text-muted mt-5" style="display:none;">
      <i class="fa-solid fa-face-frown fa-2x mb-2"></i><br>查無符合條件的活動
    </div>
  </div>
  <script>
    const eventsList = document.getElementById('eventsList');
    const noEvents = document.getElementById('noEvents');
    const categoryFilter = document.getElementById('categoryFilter');
    const dateFilter = document.getElementById('dateFilter');

    // 載入分類選項
    fetch('http://127.0.0.1:5000/api/categories')
      .then(res => res.json())
      .then(categories => {
        categoryFilter.innerHTML = '<option value="">所有分類</option>' +
          categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
      });

    // 載入活動列表
    function loadEvents() {
      const category = categoryFilter.value;
      const date = dateFilter.value;
      let url = 'http://127.0.0.1:5000/api/events';
      if (category || date) {
        url += '?';
        if (category) url += `category=${category}&`;
        if (date) url += `date=${date}`;
      }

      fetch(url)
        .then(res => res.json())
        .then(events => {
          if (events.length === 0) {
            eventsList.innerHTML = '';
            noEvents.style.display = 'block';
            return;
          }
          noEvents.style.display = 'none';
          eventsList.innerHTML = events.map(event => `
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card event-card">
                <img src="${event.image || 'https://via.placeholder.com/400x300'}" class="event-img" alt="${event.title}">
                <div class="card-body">
                  <span class="category-badge">${event.category}</span>
                  <h5 class="card-title mt-2">${event.title}</h5>
                  <p class="card-text text-muted small">
                    <i class="fa-solid fa-calendar me-1"></i>${event.date}<br>
                    <i class="fa-solid fa-users me-1"></i>${event.organizer}
                  </p>
                  <p class="card-text">${event.description}</p>
                  <a href="event_detail.html?id=${event._id}" class="btn btn-outline-primary w-100">查看詳情</a>
                </div>
              </div>
            </div>
          `).join('');
        })
        .catch(() => {
          eventsList.innerHTML = '<div class="col-12"><div class="alert alert-danger">載入活動資料失敗</div></div>';
        });
    }

    // 初始載入
    loadEvents();

    // 篩選變更時重新載入
    categoryFilter.addEventListener('change', loadEvents);
    dateFilter.addEventListener('change', loadEvents);
  </script>
</body>
</html>
