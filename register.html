<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>註冊 | 校園社團活動管理系統</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f8f9fa; }
    .register-container { max-width: 400px; margin: 60px auto; }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg mb-4">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html"><i class="fa-solid fa-people-group me-2"></i>社團活動管理</a>
      <span class="navbar-text ms-auto"><i class="fa-solid fa-user-circle me-1"></i>student</span>
    </div>
  </nav>
  <div class="register-container bg-white p-4 rounded shadow">
    <h2 class="mb-4 text-center">會員註冊</h2>
    <form id="registerForm" novalidate>
      <div class="mb-3">
        <label for="username" class="form-label">帳號 <span class="text-danger">*</span></label>
        <input type="text" class="form-control" id="username" required>
        <div class="invalid-feedback">請輸入帳號（4-16字母或數字）</div>
      </div>
      <div class="mb-3">
        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
        <input type="email" class="form-control" id="email" required>
        <div class="invalid-feedback">請輸入正確 Email 格式</div>
      </div>
      <div class="mb-3">
        <label for="password" class="form-label">密碼 <span class="text-danger">*</span></label>
        <input type="password" class="form-control" id="password" required minlength="6">
        <div class="invalid-feedback">密碼至少 6 碼</div>
      </div>
      <div class="mb-3">
        <label for="confirmPassword" class="form-label">確認密碼 <span class="text-danger">*</span></label>
        <input type="password" class="form-control" id="confirmPassword" required>
        <div class="invalid-feedback">兩次密碼需一致</div>
      </div>
      <button type="submit" class="btn btn-primary w-100">註冊</button>
    </form>
    <div id="resultMsg" class="alert mt-3 d-none" role="alert"></div>
    <div class="text-center mt-3">
      已有帳號？<a href="login.html">登入</a>
    </div>
  </div>

  <script>
    // Bootstrap 驗證與自訂驗證
    document.getElementById('registerForm').addEventListener('submit', function(e) {
      e.preventDefault();
      let valid = true;
      const username = document.getElementById('username');
      const email = document.getElementById('email');
      const password = document.getElementById('password');
      const confirmPassword = document.getElementById('confirmPassword');
      const resultMsg = document.getElementById('resultMsg');

      // 帳號驗證
      if (!/^[a-zA-Z0-9]{4,16}$/.test(username.value)) {
        username.classList.add('is-invalid');
        valid = false;
      } else {
        username.classList.remove('is-invalid');
      }
      // Email 驗證
      if (!/^[\w\.-]+@[\w\.-]+\.\w+$/.test(email.value)) {
        email.classList.add('is-invalid');
        valid = false;
      } else {
        email.classList.remove('is-invalid');
      }
      // 密碼驗證
      if (password.value.length < 6) {
        password.classList.add('is-invalid');
        valid = false;
      } else {
        password.classList.remove('is-invalid');
      }
      // 確認密碼驗證
      if (confirmPassword.value !== password.value || confirmPassword.value === '') {
        confirmPassword.classList.add('is-invalid');
        valid = false;
      } else {
        confirmPassword.classList.remove('is-invalid');
      }

      if (!valid) return;

      // 呼叫後端 API
      fetch('http://127.0.0.1:5000/api/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: username.value,
          email: email.value,
          password: password.value
        })
      })
      .then(res => res.json())
      .then(result => {
        resultMsg.classList.remove('d-none');
        if (result.success) {
          resultMsg.className = 'alert alert-success mt-3';
          resultMsg.innerHTML = '註冊成功！3 秒後導向登入頁面...';
          setTimeout(() => { window.location.href = 'login.html'; }, 3000);
        } else {
          resultMsg.className = 'alert alert-danger mt-3';
          resultMsg.textContent = result.msg;
        }
      })
      .catch(() => {
        resultMsg.classList.remove('d-none');
        resultMsg.className = 'alert alert-danger mt-3';
        resultMsg.textContent = '伺服器連線失敗';
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
